import{c,d as g}from"./chunk-5V5IBQUV.js";import{serve as h}from"@hono/node-server";import{Hono as m}from"hono";import{cors as y}from"hono/cors";import w from"open";import b from"ora";import{createClient as d}from"@supabase/supabase-js";function f(l){return d("https://oofkqgpfzbtwrqbtfvnt.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vZmtxZ3BmemJ0d3JxYnRmdm50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTg4NDE4NjUsImV4cCI6MjAxNDQxNzg2NX0.wo5H7NeQN3vLgXael7WLklTj8TArbnHTgzwVvuQdeXM",{global:{headers:{Authorization:`Bearer ${l}`}}})}async function $(){let l=new Promise((r,t)=>{let o=new m,n;o.use(y({origin:c,allowMethods:["GET"],allowHeaders:["Authorization"]})),o.use("/callback",async(e,i)=>{await i(),r({token:n})}),o.get("/callback",async e=>{let i=e.req.header("Authorization");return i?(n=i.split(" ")[1],n?e.json({success:!0},200):e.json({success:!1,error:"No token provided"},400)):e.json({success:!1,error:"No authorization header provided"},400)}),o.get("/success",async e=>e.text("Login successful, you can close this tab.")),o.get("/cancel",async e=>(t(new Error("Login cancelled")),e.text("Login cancelled, you can close this tab."))),o.get("/error",async e=>(t(new Error("Login error")),e.text("Login failed, you can close this tab.")));let u=h({fetch:o.fetch,hostname:"localhost"});u.listen();let s=u.address(),a;if(!s){t(new Error("Failed to start server"));return}typeof s=="string"?a=parseInt(s.split(":")[2]??""):a=s.port,w(`${c}/login?callbackPort=${a}`),console.log(`If nothing happens, open the following URL in your browser: ${c}/login?callbackPort=${a}`)}),p=b({text:"Authenticating...",color:"green"});try{p.start();let r=await l;if(p.stop(),!r.token){console.error("Failed to authenticate, please try again.");return}let t=f(r.token),{data:o,error:n}=await t.auth.getUser();if(n){console.error("Failed to authenticate, please try again.");return}console.log(`Hi ${o.user.email}, you are now logged in.`),g({token:r.token})}catch(r){p.stop(),console.error(r)}}export{$ as login};
