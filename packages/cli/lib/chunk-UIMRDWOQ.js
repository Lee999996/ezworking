import{a as V,b as C,e as K}from"./chunk-5V5IBQUV.js";import{promises as yt}from"node:fs";import be from"node:path";import G from"prompts";import{z as S}from"zod";var v="1";var St="3";var D="5",A="6",Y="7";import W from"fs-extra";import ee from"path";import j from"fast-glob";import U from"fs-extra";import L from"node:path";import{loadConfig as De}from"tsconfig-paths";var b={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://saas-ui.dev/docs/core/installation/nextjs-guide"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://saas-ui.dev/docs/core/installation/nextjs-pages-guide"}},remix:{name:"remix",label:"Remix",links:{installation:"https://saas-ui.dev/docs/core/installation/remix-guide"}},vite:{name:"vite",label:"Vite",links:{installation:"https://saas-ui.dev/docs/core/installation/vite-guide"}},manual:{name:"manual",label:"Manual"}};import{cosmiconfig as je}from"cosmiconfig";import M from"node:path";import{loadConfig as Ee}from"tsconfig-paths";import{z as g}from"zod";import{cyan as ke,green as Pe,red as Ce,yellow as ve}from"kleur/colors";var l={error:Ce,warn:ve,info:ke,success:Pe};import{createMatchPath as Te}from"tsconfig-paths";async function h(e,t){return Te(t.absoluteBaseUrl,t.paths)(e,void 0,()=>!0,[".ts",".tsx"])}var X="@/components",Z="@/lib/utils";var Oe=je("components",{searchPlaces:["components.json"]}),R=g.object({$schema:g.string().optional(),system:g.string().optional().default("chakra"),style:g.string().optional().default("default"),rsc:g.coerce.boolean().default(!1),tsx:g.coerce.boolean().default(!0),aliases:g.object({components:g.string(),utils:g.string(),ui:g.string().optional(),lib:g.string().optional(),hooks:g.string().optional()})}).strict(),Fe=R.extend({resolvedPaths:g.object({cwd:g.string(),utils:g.string(),components:g.string(),lib:g.string(),hooks:g.string(),ui:g.string()})});async function T(e){let t=await Ne(e);return t?await k(e,t):null}async function k(e,t){let r=await Ee(e);if(r.resultType==="failed")throw new Error(`Failed to load ${t.tsx?"tsconfig":"jsconfig"}.json. ${r.message??""}`.trim());return Fe.parse({...t,resolvedPaths:{cwd:e,utils:await h(t.aliases.utils,r),components:await h(t.aliases.components,r),ui:t.aliases.ui?await h(t.aliases.ui,r):M.resolve(await h(t.aliases.components,r)??e,"ui"),lib:t.aliases.lib?await h(t.aliases.lib,r):M.resolve(await h(t.aliases.utils,r)??e,".."),hooks:t.aliases.hooks?await h(t.aliases.hooks,r):M.resolve(await h(t.aliases.components,r)??e,"..","hooks")}})}async function Ne(e){try{let t=await Oe.search(e);return t?R.parse(t.config):null}catch{let r=`${e}/components.json`;throw new Error(`Invalid configuration found in ${l.info(r)}.`)}}import _e from"node:fs";import $e from"node:path";function q(e="",t=!0){let r=$e.join(e,"package.json"),n=_e.readFileSync(r,"utf8");try{return JSON.parse(n)}catch(s){if(t)throw s}return null}var E=["**/node_modules/**",".next","public","dist","build"];async function I(e){let[t,r,n,s,c,a,m]=await Promise.all([j.glob("**/{next,vite,astro}.config.*|gatsby-config.*|composer.json",{cwd:e,deep:3,ignore:E}),U.pathExists(L.resolve(e,"src")),Le(e),Me(e),Ae(e),Ue(e),q(e,!1)]),f=await U.pathExists(L.resolve(e,`${r?"src/":""}app`)),p={framework:b.manual,isSrcDir:r,isRSC:!1,isTsx:n,tailwindConfigFile:s,tailwindCssFile:c,aliasPrefix:a};return t.find(y=>y.startsWith("next.config."))?.length?(p.framework=f?b["next-app"]:b["next-pages"],p.isRSC=f,p):Object.keys(m?.dependencies??{}).find(y=>y.startsWith("@remix-run/"))?(p.framework=b.remix,p):(t.find(y=>y.startsWith("vite.config."))?.length&&(p.framework=b.vite),p)}async function Ae(e){let t=await j.glob(["**/*.css","**/*.scss"],{cwd:e,deep:5,ignore:E});if(!t.length)return null;for(let r of t)if((await U.readFile(L.resolve(e,r),"utf8")).includes("@tailwind base"))return r;return null}async function Me(e){let t=await j.glob("tailwind.config.*",{cwd:e,deep:3,ignore:E});return t.length?t[0]:null}async function Ue(e){let t=await De(e);if(t?.resultType==="failed"||!t?.paths)return null;for(let[r,n]of Object.entries(t.paths))if(n.includes("./*")||n.includes("./src/*")||n.includes("./app/*")||n.includes("./resources/js/*"))return r.at(0)??null;return null}async function Le(e){return(await j.glob("tsconfig.*",{cwd:e,deep:1,ignore:E})).length>0}async function Q(e,t=null){let[r,n]=await Promise.all([T(e),t?Promise.resolve(t):I(e)]);if(r)return r;if(!n||!n.tailwindConfigFile||!n.tailwindCssFile)return null;let s={$schema:C,rsc:n.isRSC,tsx:n.isTsx,system:"chakra",style:"default",aliases:{components:`${n.aliasPrefix}/components`,ui:`${n.aliasPrefix}/components/ui`,hooks:`${n.aliasPrefix}/hooks`,lib:`${n.aliasPrefix}/lib`,utils:`${n.aliasPrefix}/lib/utils`}};return await k(e,s)}var i={error(...e){console.log(l.error(e.join(" ")))},warn(...e){console.log(l.warn(e.join(" ")))},info(...e){console.log(l.info(e.join(" ")))},success(...e){console.log(l.success(e.join(" ")))},debug(...e){process.env.DEBUG&&console.log(e.join(" "))},log(...e){console.log(e.join(" "))},break(){console.log("")}};import We from"ora";function u(e,t){return We({text:e,isSilent:t?.silent})}async function te(e){let t={};if(!W.existsSync(e.cwd)||!W.existsSync(ee.resolve(e.cwd,"package.json")))return t[v]=!0,{errors:t,projectInfo:null};let r=u("Preflight checks.",{silent:e.silent}).start();W.existsSync(ee.resolve(e.cwd,"components.json"))&&!e.force&&(r?.fail(),i.break(),i.error(`A ${l.info("components.json")} file already exists at ${l.info(e.cwd)}.
To start over, remove the ${l.info("components.json")} file and run ${l.info("init")} again.`),i.break(),process.exit(1)),r?.succeed();let n=u("Verifying framework.",{silent:e.silent}).start(),s=await I(e.cwd);(!s||s?.framework.name==="manual")&&(t[Y]=!0,n?.fail(),i.break(),s?.framework.links.installation&&i.error(`We could not detect a supported framework at ${l.info(e.cwd)}.
Visit ${l.info(s?.framework.links.installation)} to manually configure your project.
Once configured, you can use the cli to add components.`),i.break(),process.exit(1)),n?.succeed(`Verifying framework. Found ${l.info(s.framework.label)}.`);let c=u("Validating Tailwind CSS.",{silent:e.silent}).start();!s?.tailwindConfigFile||!s?.tailwindCssFile?(t[D]=!0,c?.fail()):c?.succeed();let a=u("Validating import alias.",{silent:e.silent}).start();return s?.aliasPrefix?a?.succeed():(t[A]=!0,a?.fail()),Object.keys(t).length>0&&(t[D]&&(i.break(),i.error(`No Tailwind CSS configuration found at ${l.info(e.cwd)}.`),i.error("It is likely you do not have Tailwind CSS installed or have an invalid configuration."),i.error("Install Tailwind CSS then try again."),s?.framework.links.tailwind&&i.error(`Visit ${l.info(s?.framework.links.tailwind)} to get started.`)),t[A]&&(i.break(),i.error("No import alias found in your tsconfig.json file."),s?.framework.links.installation&&i.error(`Visit ${l.info(s?.framework.links.installation)} to learn how to set an import alias.`)),i.break(),process.exit(1)),{errors:t,projectInfo:s}}import{z as ze}from"zod";function w(e){if(i.error("Something went wrong. Please check the error below for more details."),i.error("If the problem persists, please open an issue on GitHub."),i.error(""),typeof e=="string"&&(i.error(e),i.break(),process.exit(1)),e instanceof ze.ZodError){i.error("Validation failed:");for(let[t,r]of Object.entries(e.flatten().fieldErrors))i.error(`- ${l.info(t)}: ${r}`);i.break(),process.exit(1)}e instanceof Error&&(i.error(e.message),i.break(),process.exit(1)),i.break(),process.exit(1)}import z from"deepmerge";import{HttpsProxyAgent as Ve}from"https-proxy-agent";import Ke from"node-fetch";import{z as Ye}from"zod";import{z as o}from"zod";var re=o.enum(["registry:style","registry:lib","registry:example","registry:block","registry:component","registry:ui","registry:hook","registry:theme","registry:page","registry:story"]),oe=o.object({path:o.string(),content:o.string().optional(),type:re,target:o.string().optional()}),Ge=o.object({config:o.object({content:o.array(o.string()).optional(),theme:o.record(o.string(),o.any()).optional(),plugins:o.array(o.string()).optional()}).optional()}),Be=o.object({light:o.record(o.string(),o.string()).optional(),dark:o.record(o.string(),o.string()).optional()}),P=o.object({name:o.string(),type:re,private:o.boolean().optional(),description:o.string().optional(),dependencies:o.array(o.string()).optional(),devDependencies:o.array(o.string()).optional(),registryDependencies:o.array(o.string()).optional(),files:o.array(oe).optional(),tailwind:Ge.optional(),cssVars:Be.optional(),meta:o.record(o.string(),o.any()).optional(),docs:o.string().optional(),category:o.string().optional(),subcategory:o.string().optional()}),ne=o.array(P.extend({files:o.array(o.union([o.string(),oe])).optional()})),se=o.array(o.object({name:o.string(),label:o.string()})),Je=o.object({inlineColors:o.object({light:o.record(o.string(),o.string()),dark:o.record(o.string(),o.string())}),cssVars:o.object({light:o.record(o.string(),o.string()),dark:o.record(o.string(),o.string())}),inlineColorsTemplate:o.string(),cssVarsTemplate:o.string()}),ie=P.pick({dependencies:!0,devDependencies:!0,files:!0,tailwind:!0,cssVars:!0,docs:!0});var He=process.env.https_proxy?new Ve(process.env.https_proxy):void 0;async function Xe(){try{let[e]=await O(["index.json"]);return ne.parse(e)}catch(e){i.error(`
`),w(e)}}async function ae(){try{let[e]=await O(["styles/index.json"]);return se.parse(e)}catch(e){return i.error(`
`),w(e),[]}}async function le(){return[{name:"neutral",label:"Neutral"},{name:"gray",label:"Gray"},{name:"zinc",label:"Zinc"},{name:"stone",label:"Stone"},{name:"slate",label:"Slate"}]}async function O(e){try{let t=await K(),r=new Headers;return t?.token&&r.set("Authorization",`Bearer ${t.token}`),await Promise.all(e.map(async s=>{let c=fe(s),a=await Ke(c,{agent:He,headers:r});if(!a.ok){let m={400:"Bad request",401:"Unauthorized",403:"Forbidden",404:"Not found",500:"Internal server error"};if(a.status===401)throw new Error(`You are not authorized to access the component at ${l.info(c)}.
If this is a remote registry, you may need to authenticate.`);if(a.status===404)throw new Error(`The component at ${l.info(c)} was not found.
It may not exist at the registry. Please make sure it is a valid component.`);if(a.status===403)throw new Error(`You do not have access to the component at ${l.info(c)}.
If this is a remote registry, you may need to authenticate or a token.`);let f=await a.json(),p=f&&typeof f=="object"&&"error"in f?f.error:a.statusText||m[a.status];throw new Error(`Failed to fetch from ${l.info(c)}.
${p}`)}return a.json()}))}catch(t){return i.error(`
`),w(t),[]}}function ce(e,t,r){return r||(e.type==="registry:ui"?t.resolvedPaths.ui:e.type==="registry:lib"?t.resolvedPaths.lib:e.type==="registry:block"||e.type==="registry:component"?t.resolvedPaths.components:e.type==="registry:hook"?t.resolvedPaths.hooks:(e.type==="registry:page",t.resolvedPaths.components))}async function pe(e,t){try{if(!await Xe())return null;e.includes("index")&&e.unshift("index");let n=[];for(let f of e){let p=await Ze(f,t);n.push(...p)}let s=Array.from(new Set(n)),c=await O(s),a=Ye.array(P).parse(c);if(!a)return null;let m="";return a.forEach(f=>{f.docs&&(m+=`${f.docs}
`)}),ie.parse({dependencies:z.all(a.map(f=>f.dependencies??[])),devDependencies:z.all(a.map(f=>f.devDependencies??[])),files:z.all(a.map(f=>f.files??[])),docs:m})}catch(r){return w(r),null}}async function Ze(e,t){let r=new Set,n=[];async function s(c){let a=fe(me(c)?c:`styles/${t.style}/${c}.json`);if(!r.has(a)){r.add(a);try{let[m]=await O([a]),f=P.parse(m);if(n.push(a),f.registryDependencies)for(let p of f.registryDependencies)await s(p)}catch(m){console.error(`Error fetching or parsing registry item at ${c}:`,m)}}}return await s(e),Array.from(new Set(n))}function fe(e){if(me(e)){let t=new URL(e);return t.pathname.match(/\/chat\/b\//)&&!t.pathname.endsWith("/json")&&(t.pathname=`${t.pathname}/json`),t.toString()}return`${V}/${e}`}function me(e){try{return new URL(e),!0}catch{return!1}}import{execa as Qe}from"execa";import{detect as qe}from"@antfu/ni";async function ge(e,{withFallback:t}={withFallback:!1}){let r=await qe({programmatic:!0,cwd:e});if(r==="yarn@berry")return"yarn";if(r==="pnpm@6")return"pnpm";if(r==="bun")return"bun";if(!t)return r??"npm";let n=process.env.npm_config_user_agent||"";return n.startsWith("yarn")?"yarn":n.startsWith("pnpm")?"pnpm":n.startsWith("bun")?"bun":"npm"}async function ue(e,t,r){if(e=Array.from(new Set(e)),!e?.length)return;r={silent:!1,...r};let n=u("Installing dependencies.",{silent:r.silent})?.start(),s=await ge(t.resolvedPaths.cwd);await Qe(s,[s==="npm"?"install":"add",...e],{cwd:t.resolvedPaths.cwd}),n?.succeed()}import{existsSync as we,promises as xe}from"node:fs";import x,{basename as mt}from"node:path";import gt from"prompts";import{promises as it}from"node:fs";import{tmpdir as at}from"node:os";import de from"node:path";import{Project as lt,ScriptKind as ct}from"ts-morph";var F=async({sourceFile:e,config:t})=>{let r=e.getImportDeclarations();for(let n of r){let s=et(n.getModuleSpecifierValue(),t);n.setModuleSpecifier(s),s=="@/lib/utils"&&n.getNamedImports().find(m=>m.getName()==="cn")&&n.setModuleSpecifier(s.replace(/^@\/lib\/utils/,t.aliases.utils))}return e};function et(e,t){if(!e.startsWith("@/"))return e;if(!e.startsWith("@/registry/")){let r=t.aliases.components.charAt(0);return e.replace(/^@\//,`${r}/`)}return e.match(/^@\/registry\/(.+)\/ui/)?e.replace(/^@\/registry\/(.+)\/ui/,t.aliases.ui??`${t.aliases.components}/ui`):t.aliases.components&&e.match(/^@\/registry\/(.+)\/components/)?e.replace(/^@\/registry\/(.+)\/components/,t.aliases.components):t.aliases.lib&&e.match(/^@\/registry\/(.+)\/lib/)?e.replace(/^@\/registry\/(.+)\/lib/,t.aliases.lib):t.aliases.hooks&&e.match(/^@\/registry\/(.+)\/hooks/)?e.replace(/^@\/registry\/(.+)\/hooks/,t.aliases.hooks):e.replace(/^@\/registry\/[^/]+/,t.aliases.components)}import*as N from"recast";import{transformFromAstSync as tt}from"@babel/core";import{parse as rt}from"@babel/parser";import ot from"@babel/plugin-transform-typescript";var nt={sourceType:"module",allowImportExportEverywhere:!0,allowReturnOutsideFunction:!0,startLine:1,tokens:!0,plugins:["asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","classStaticBlock","decimal","decorators-legacy","doExpressions","dynamicImport","exportDefaultFrom","exportNamespaceFrom","functionBind","functionSent","importAssertions","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{proposal:"minimal"}],["recordAndTuple",{syntaxType:"hash"}],"throwExpressions","topLevelAwait","v8intrinsic","typescript","jsx"]},ye=async({sourceFile:e,config:t})=>{let r=e.getFullText();if(t.tsx)return r;let n=N.parse(r,{parser:{parse:c=>rt(c,nt)}}),s=tt(n,r,{cloneInputAst:!1,code:!1,ast:!0,plugins:[ot],configFile:!1});if(!s||!s.ast)throw new Error("Failed to transform JSX");return N.print(s.ast).code};import{SyntaxKind as st}from"ts-morph";var _=async({sourceFile:e,config:t})=>{if(t.rsc)return e;let r=e.getFirstChildByKind(st.ExpressionStatement);return r?.getText()==='"use client"'&&r.remove(),e};var pt=new lt({compilerOptions:{}});async function ft(e){let t=await it.mkdtemp(de.join(at(),"sui-"));return de.join(t,e)}async function he(e,t=[F,_]){let r=await ft(e.filename),n=pt.createSourceFile(r,e.raw,{scriptKind:ct.TSX});for(let s of t)s({sourceFile:n,...e});return e.transformJsx?await ye({sourceFile:n,...e}):n.getText()}function ut(e,t,r){return r.startsWith("~/")?x.join(t.resolvedPaths.cwd,r.replace("~/","")):e?.isSrcDir?x.join(t.resolvedPaths.cwd,"src",r):x.join(t.resolvedPaths.cwd,r)}async function Se(e,t,r){if(!e?.length)return;r={overwrite:!1,force:!1,silent:!1,...r};let n=u("Updating files.",{silent:r.silent})?.start(),[s]=await Promise.all([I(t.resolvedPaths.cwd)]),c=[],a=[],m=[];for(let p of e){if(!p.content)continue;let y=ce(p,t),B=mt(p.path),d=x.join(y,B);p.target&&(d=ut(s,t,p.target),y=x.dirname(d)),t.tsx||(d=d.replace(/\.tsx?$/,$=>$===".tsx"?".jsx":".js"));let J=we(d);if(J&&!r.overwrite){n.stop();let{overwrite:$}=await gt({type:"confirm",name:"overwrite",message:`The file ${l.info(B)} already exists. Would you like to overwrite?`,initial:!1});if(!$){m.push(x.relative(t.resolvedPaths.cwd,d));continue}n?.start()}we(y)||await xe.mkdir(y,{recursive:!0});let Re=await he({filename:p.path,raw:p.content,config:t,transformJsx:!t.tsx},[F,_]);await xe.writeFile(d,Re,"utf-8"),J?a.push(x.relative(t.resolvedPaths.cwd,d)):c.push(x.relative(t.resolvedPaths.cwd,d))}if(!(c.length||a.length)&&!m.length&&n?.info("No files updated."),c.length){if(n?.succeed(`Created ${c.length} ${c.length===1?"file":"files"}:`),!r.silent)for(let p of c)i.log(`  - ${p}`)}else n?.stop();if(a.length&&(u(`Updated ${a.length} ${a.length===1?"file":"files"}:`,{silent:r.silent})?.info(),!r.silent))for(let p of a)i.log(`  - ${p}`);if(m.length&&(u(`Skipped ${m.length} ${a.length===1?"file":"files"}:`,{silent:r.silent})?.info(),!r.silent))for(let p of m)i.log(`  - ${p}`);r.silent||i.break()}async function Ie(e,t,r){r={overwrite:!1,silent:!1,isNewProject:!1,...r};let n=u("Checking registry.",{silent:r.silent})?.start(),s=await pe(e,t);if(!s)return n?.fail(),w(new Error("Failed to fetch components from registry."));n?.succeed(),await ue(s.dependencies,t,{silent:r.silent}),await Se(s.files,t,{overwrite:r.overwrite,silent:r.silent}),s.docs&&i.info(s.docs)}var dt=S.object({cwd:S.string(),components:S.array(S.string()).optional(),yes:S.boolean(),defaults:S.boolean(),force:S.boolean(),silent:S.boolean()});async function Io(e,...t){try{let r=dt.parse({...e,cwd:be.resolve(e.cwd??process.cwd()),isNewProject:!1,components:t});await ht(r),i.log(`${l.success("Success!")} Project initialization completed.
You may now add components.`),i.break()}catch(r){i.break(),w(r)}}async function ht(e){let t;if(e.skipPreflight)t=await I(e.cwd);else{let f=await te(e);f.errors[v]&&process.exit(1),t=f.projectInfo}let r=await Q(e.cwd,t),n=r?await xt(r,e):await wt(await T(e.cwd));if(!e.yes){let{proceed:f}=await G({type:"confirm",name:"proceed",message:`Write configuration to ${l.info("components.json")}. Proceed?`,initial:!0});f||process.exit(0)}let s=u("Writing components.json.").start(),c=be.resolve(e.cwd,"components.json");await yt.writeFile(c,JSON.stringify(n,null,2),"utf8"),s.succeed();let a=await k(e.cwd,n),m=["index",...e.components||[]];return await Ie(m,a,{overwrite:!0,silent:e.silent,isNewProject:e.isNewProject||t?.framework.name==="next-app"}),a}async function wt(e=null){i.info("");let t=await G([{type:"toggle",name:"typescript",message:`Would you like to use ${l.info("TypeScript")} (recommended)?`,initial:e?.tsx??!0,active:"yes",inactive:"no"},{type:"text",name:"components",message:`Configure the import alias for ${l.info("components")}:`,initial:e?.aliases.components??X},{type:"text",name:"utils",message:`Configure the import alias for ${l.info("utils")}:`,initial:e?.aliases.utils??Z},{type:"toggle",name:"rsc",message:`Are you using ${l.info("React Server Components")}?`,initial:e?.rsc??!0,active:"yes",inactive:"no"}]);return R.parse({$schema:C,system:"chakra",style:"default",rsc:t.rsc,tsx:t.typescript,aliases:{utils:t.utils,components:t.components,lib:t.components.replace(/\/components$/,"lib"),hooks:t.components.replace(/\/components$/,"hooks")}})}async function xt(e,t){let r=e.style;if(!t.defaults){let[n,s]=await Promise.all([ae(),le()]);r=(await G([{type:"select",name:"style",message:`Which ${l.info("style")} would you like to use?`,choices:n.map(a=>({title:a.label,value:a.name})),initial:n.findIndex(a=>a.name===r)}])).style}return R.parse({$schema:e?.$schema,style:r,rsc:e?.rsc,tsx:e?.tsx,aliases:e?.aliases})}export{v as a,St as b,l as c,T as d,i as e,w as f,Xe as g,Ie as h,dt as i,Io as j,ht as k};
